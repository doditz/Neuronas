{% extends "layout.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/mobile.css') }}">
<style>
  /* Ajouts pour le Prime Directive Core */
  .prime-directive {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(52, 152, 219, 0.2) 0%, rgba(0, 0, 0, 0) 70%);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
  }
  
  .prime-core {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.8), rgba(155, 89, 182, 0.8));
    box-shadow: 0 0 10px rgba(52, 152, 219, 0.8), 0 0 20px rgba(155, 89, 182, 0.4);
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    font-size: 10px;
    font-weight: bold;
    animation: core-pulse 2s infinite;
  }
  
  @keyframes core-pulse {
    0% { transform: scale(1); box-shadow: 0 0 10px rgba(52, 152, 219, 0.8), 0 0 20px rgba(155, 89, 182, 0.4); }
    50% { transform: scale(1.1); box-shadow: 0 0 15px rgba(52, 152, 219, 0.9), 0 0 30px rgba(155, 89, 182, 0.5); }
    100% { transform: scale(1); box-shadow: 0 0 10px rgba(52, 152, 219, 0.8), 0 0 20px rgba(155, 89, 182, 0.4); }
  }
  
  .quantum-particles {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }
  
  .quantum-particle {
    position: absolute;
    width: 4px;
    height: 4px;
    background-color: rgba(52, 152, 219, 0.6);
    border-radius: 50%;
  }
  
  .ethical-validation {
    position: absolute;
    top: 5px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 2px 6px;
    font-size: 8px;
    color: rgba(255, 255, 255, 0.8);
  }
  
  .ethical-score {
    color: #2ecc71;
    font-weight: bold;
  }
  
  .ethical-alert {
    color: #e74c3c;
    font-weight: bold;
  }
</style>
{% endblock %}

{% block content %}
<div class="duplex-container">
  <!-- Zone des h√©misph√®res -->
  <div class="hemispheres-container">
    <!-- H√©misph√®re gauche -->
    <div class="hemisphere-box hemisphere-left">
      <div class="hemisphere-title">H√©misph√®re Gauche</div>
      <span class="process-badge badge bg-info">Analytique</span>
      <div class="tier-badge">L1: <span id="l1-count">0</span></div>
      <div class="tier-badge">L2: <span id="l2-count">0</span></div>
      <div class="tier-badge">L3: <span id="l3-count">0</span></div>
    </div>
    
    <!-- H√©misph√®re droit -->
    <div class="hemisphere-box hemisphere-right">
      <div class="hemisphere-title">H√©misph√®re Droit</div>
      <span class="process-badge badge bg-info">Cr√©atif</span>
      <div class="tier-badge">R1: <span id="r1-count">0</span></div>
      <div class="tier-badge">R2: <span id="r2-count">0</span></div>
      <div class="tier-badge">R3: <span id="r3-count">0</span></div>
    </div>
  </div>
  
  <!-- Zone d'interaction en bas -->
  <div class="interaction-zone">
    <!-- Visualisation des interactions cognitives -->
    <div class="cognitive-interactions">
      <div class="neural-connections" id="neural-viz">
        <!-- Canvas pour les visualisations d3.js -->
        <div class="quantum-particles" id="quantum-particles"></div>
        
        <!-- Prime Directive Core au centre -->
        <div class="prime-directive">
          <div class="prime-core" id="prime-core">PD</div>
          <div class="ethical-validation">
            <span>üîí √âthique: </span><span class="ethical-score" id="ethical-score">99.2%</span>
          </div>
        </div>
      </div>
      
      <!-- Statistiques de probabilit√© entre h√©misph√®res -->
      <div class="probability-stats">
        <span class="stats-label">Activation G/D:</span>
        <span class="stats-value" id="left-prob">45%</span>
        <span class="stats-label">/</span>
        <span class="stats-value" id="right-prob">55%</span>
        <span class="stats-label ml-2">Entropie:</span>
        <span class="stats-value" id="entropy-value">0.34</span>
        <span class="stats-label ml-2">D2:</span>
        <span class="stats-value" id="d2-value">0.67</span>
      </div>
      
      <!-- Journal des √©v√©nements cognitifs -->
      <div class="cognitive-events" id="cognitive-log">
        <div class="event-entry"><span class="event-time">14:32:15</span> <span class="ethical-score">‚úì</span> Prime Directive validation (99.2%)</div>
        <div class="event-entry"><span class="event-time">14:32:14</span> QRONAS: 128 sc√©narios quantiques g√©n√©r√©s</div>
        <div class="event-entry"><span class="event-time">14:32:13</span> BRONAS: Filtrage √©thique (37 vetos)</div>
        <div class="event-entry"><span class="event-time">14:32:12</span> D2Stim: Optimisation poids moraux (ISO 7000)</div>
        <div class="event-entry"><span class="event-time">14:32:10</span> Latence d√©cisionnelle: 83ms</div>
      </div>
      
      <!-- Modules actifs -->
      <div class="active-modules">
        <div class="module-chip">D2Stim</div>
        <div class="module-chip">QRONAS</div>
        <div class="module-chip">BRONAS</div>
        <div class="module-chip">QuAC</div>
        <div class="module-chip">D2Spin</div>
        <div class="module-chip">QkISM</div>
        <div class="module-chip">SMAS</div>
      </div>
    </div>
    
    <!-- Contr√¥les de modulation -->
    <div class="control-panel">
      <div class="mode-button btn btn-outline-info btn-sm" id="d2pin-btn">
        <i data-feather="minus-circle" class="feather-xxs"></i> D2Pin
      </div>
      <div class="mode-button btn btn-outline-secondary btn-sm" id="balanced-btn">
        <i data-feather="circle" class="feather-xxs"></i> √âquilibr√©
      </div>
      <div class="mode-button btn btn-outline-info btn-sm" id="d2stim-btn">
        <i data-feather="plus-circle" class="feather-xxs"></i> D2Stim
      </div>
    </div>
    
    <!-- Zone d'entr√©e de requ√™te -->
    <div class="query-input-zone">
      <input type="text" class="query-input" id="query-input" 
             placeholder="Entrez votre requ√™te cognitive..." autocomplete="off">
      
      <!-- Indicateurs de performance -->
      <div class="performance-indicators">
        <div class="indicator">
          Focus: <span class="indicator-value" id="focus-ind">0.75</span>
        </div>
        <div class="indicator">
          Temps: <span class="indicator-value" id="time-ind">0.3s</span>
        </div>
        <div class="indicator">
          Type: <span class="indicator-value" id="type-ind">Analytique</span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://d3js.org/d3.v7.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Initialisation des visualisations
    initNeuralViz();
    
    // Initialiser les compteurs
    updateCounters();
    
    // Cr√©er les particules quantiques
    createQuantumParticles();
    
    // Simulation des √©v√©nements en temps r√©el
    startCognitiveSimulation();
    
    // Initialiser la Prime Directive Core
    initPrimeDirective();
    
    // Gestionnaires d'√©v√©nements pour les boutons de mode
    document.getElementById('d2pin-btn').addEventListener('click', function() {
      setMode('pin');
    });
    
    document.getElementById('balanced-btn').addEventListener('click', function() {
      setMode('balanced');
    });
    
    document.getElementById('d2stim-btn').addEventListener('click', function() {
      setMode('stim');
    });
    
    // Gestionnaire d'√©v√©nement pour l'entr√©e de requ√™te
    document.getElementById('query-input').addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        processQuery(this.value);
        this.value = '';
      }
    });
    
    // Fonction pour initialiser la visualisation neurale
    function initNeuralViz() {
      const container = document.getElementById('neural-viz');
      const width = container.clientWidth;
      const height = container.clientHeight;
      
      // Cr√©er des n≈ìuds neuronaux al√©atoires
      for (let i = 0; i < 15; i++) {
        const node = document.createElement('div');
        node.className = 'neural-node';
        node.style.left = `${Math.random() * width}px`;
        node.style.top = `${Math.random() * height}px`;
        node.style.animationDelay = `${Math.random() * 2}s`;
        container.appendChild(node);
      }
      
      // Cr√©er des connexions entre n≈ìuds
      const nodes = container.querySelectorAll('.neural-node');
      for (let i = 0; i < 20; i++) {
        const connection = document.createElement('div');
        connection.className = 'neural-connection';
        
        const startNode = nodes[Math.floor(Math.random() * nodes.length)];
        const endNode = nodes[Math.floor(Math.random() * nodes.length)];
        
        const startX = parseInt(startNode.style.left);
        const startY = parseInt(startNode.style.top);
        const endX = parseInt(endNode.style.left);
        const endY = parseInt(endNode.style.top);
        
        // Calculer la distance et l'angle
        const dx = endX - startX;
        const dy = endY - startY;
        const distance = Math.sqrt(dx * dx + dy * dy);
        const angle = Math.atan2(dy, dx) * 180 / Math.PI;
        
        // Positionner la connexion
        connection.style.width = `${distance}px`;
        connection.style.left = `${startX + 4}px`;
        connection.style.top = `${startY + 4}px`;
        connection.style.transform = `rotate(${angle}deg)`;
        
        container.appendChild(connection);
      }
      
      // Ajouter des particules de flux de donn√©es
      for (let i = 0; i < 10; i++) {
        const particle = document.createElement('div');
        particle.className = 'data-particle';
        particle.style.left = `${Math.random() * width}px`;
        particle.style.top = `${Math.random() * height}px`;
        particle.style.animationDelay = `${Math.random() * 3}s`;
        container.appendChild(particle);
      }
    }
    
    // Fonction pour mettre √† jour les compteurs
    function updateCounters() {
      document.getElementById('l1-count').textContent = Math.floor(Math.random() * 20);
      document.getElementById('l2-count').textContent = Math.floor(Math.random() * 50);
      document.getElementById('l3-count').textContent = Math.floor(Math.random() * 100);
      document.getElementById('r1-count').textContent = Math.floor(Math.random() * 20);
      document.getElementById('r2-count').textContent = Math.floor(Math.random() * 50);
      document.getElementById('r3-count').textContent = Math.floor(Math.random() * 100);
    }
    
    // Fonction pour cr√©er les particules quantiques
    function createQuantumParticles() {
      const container = document.getElementById('quantum-particles');
      const containerRect = container.getBoundingClientRect();
      const width = containerRect.width;
      const height = containerRect.height;
      
      // Cr√©er des particules quantiques qui se d√©placent entre les h√©misph√®res
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'quantum-particle';
        
        // Position initiale al√©atoire
        const x = Math.random() * width;
        const y = Math.random() * height;
        
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        
        // Ajouter une animation CSS personnalis√©e pour chaque particule
        const animDuration = 3 + Math.random() * 4;
        const targetX = Math.random() * width;
        const targetY = Math.random() * height;
        
        particle.style.transition = `all ${animDuration}s ease-in-out`;
        
        container.appendChild(particle);
        
        // Animer la particule
        setTimeout(() => {
          particle.style.left = `${targetX}px`;
          particle.style.top = `${targetY}px`;
          
          // Cr√©er une nouvelle animation apr√®s la fin de la pr√©c√©dente
          setInterval(() => {
            const newX = Math.random() * width;
            const newY = Math.random() * height;
            particle.style.left = `${newX}px`;
            particle.style.top = `${newY}px`;
          }, animDuration * 1000);
        }, 100);
      }
    }
    
    // Fonction pour initialiser le Prime Directive Core
    function initPrimeDirective() {
      const primeCore = document.getElementById('prime-core');
      const ethicalScore = document.getElementById('ethical-score');
      
      // Animation de pulsation du core
      setInterval(() => {
        // Mettre √† jour le score √©thique p√©riodiquement
        const newScore = (98 + Math.random() * 1.9).toFixed(1);
        ethicalScore.textContent = `${newScore}%`;
        
        // Simuler des validations √©thiques dans le log
        if (Math.random() > 0.8) {
          const cogLog = document.getElementById('cognitive-log');
          const now = new Date();
          const timeStr = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
          
          const validationEvent = document.createElement('div');
          validationEvent.className = 'event-entry';
          
          if (Math.random() > 0.1) {
            // Validation normale (90% du temps)
            validationEvent.innerHTML = `<span class="event-time">${timeStr}</span> <span class="ethical-score">‚úì</span> Validation Prime Directive (${newScore}%)`;
          } else {
            // Alerte √©thique (10% du temps)
            const alertScore = (90 + Math.random() * 5).toFixed(1);
            validationEvent.innerHTML = `<span class="event-time">${timeStr}</span> <span class="ethical-alert">‚ö†</span> Veto √©thique BRONAS (${alertScore}%)`;
          }
          
          cogLog.insertBefore(validationEvent, cogLog.firstChild);
          
          // Limiter √† 5 √©v√©nements
          if (cogLog.children.length > 5) {
            cogLog.removeChild(cogLog.lastChild);
          }
        }
      }, 5000);
    }
    
    // Fonction pour simuler l'activit√© cognitive
    function startCognitiveSimulation() {
      const cogLog = document.getElementById('cognitive-log');
      const events = [
        "QRONAS: 128 sc√©narios quantiques g√©n√©r√©s",
        "BRONAS: Filtrage √©thique (41 vetos)",
        "D2Stim: Optimisation poids moraux (ISO 7000)",
        "Latence d√©cisionnelle: 76ms",
        "Synchronisation h√©misph√©rique (P=0.92)",
        "R√©duction d'entropie morale: 35%",
        "D2Spin: Stabilisation neurosymbolique",
        "QuAC: Compression adaptative (ratio: 0.7)",
        "BRONAS: Coh√©rence √©thique 99.3%",
        "QRONAS: Collapse quantique optimal",
        "D2Pin: Inhibition cognitive (biais d√©tect√©)",
        "SMAS: Validation ISO 24089 compl√®te",
        "Int√©gration QkISM (vect=317)"
      ];
      
      // Mettre √† jour les statistiques toutes les 2 secondes
      setInterval(() => {
        document.getElementById('left-prob').textContent = `${Math.floor(Math.random() * 30 + 30)}%`;
        document.getElementById('right-prob').textContent = `${Math.floor(Math.random() * 30 + 30)}%`;
        document.getElementById('entropy-value').textContent = (Math.random() * 0.5 + 0.2).toFixed(2);
        document.getElementById('d2-value').textContent = (Math.random() * 0.5 + 0.3).toFixed(2);
      }, 2000);
      
      // Ajouter un √©v√©nement cognitif toutes les 5 secondes
      setInterval(() => {
        const now = new Date();
        const timeStr = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
        const randomEvent = events[Math.floor(Math.random() * events.length)];
        
        const eventNode = document.createElement('div');
        eventNode.className = 'event-entry';
        eventNode.innerHTML = `<span class="event-time">${timeStr}</span> ${randomEvent}`;
        
        cogLog.insertBefore(eventNode, cogLog.firstChild);
        
        // Limiter √† 5 √©v√©nements
        if (cogLog.children.length > 5) {
          cogLog.removeChild(cogLog.lastChild);
        }
      }, 5000);
    }
    
    // Fonction pour d√©finir le mode
    function setMode(mode) {
      // Mettre √† jour les boutons
      document.getElementById('d2pin-btn').className = mode === 'pin' ? 'mode-button btn btn-info btn-sm' : 'mode-button btn btn-outline-info btn-sm';
      document.getElementById('balanced-btn').className = mode === 'balanced' ? 'mode-button btn btn-secondary btn-sm' : 'mode-button btn btn-outline-secondary btn-sm';
      document.getElementById('d2stim-btn').className = mode === 'stim' ? 'mode-button btn btn-info btn-sm' : 'mode-button btn btn-outline-info btn-sm';
      
      // Simuler un changement d'√©tat du syst√®me
      const hemisphereL = document.querySelector('.hemisphere-left');
      const hemisphereR = document.querySelector('.hemisphere-right');
      
      if (mode === 'pin') {
        hemisphereL.style.opacity = "1";
        hemisphereR.style.opacity = "0.6";
        document.getElementById('left-prob').textContent = "75%";
        document.getElementById('right-prob').textContent = "25%";
        document.getElementById('d2-value').textContent = "0.82";
      } else if (mode === 'stim') {
        hemisphereL.style.opacity = "0.6";
        hemisphereR.style.opacity = "1";
        document.getElementById('left-prob').textContent = "25%";
        document.getElementById('right-prob').textContent = "75%";
        document.getElementById('d2-value').textContent = "0.32";
      } else {
        hemisphereL.style.opacity = "0.8";
        hemisphereR.style.opacity = "0.8";
        document.getElementById('left-prob').textContent = "50%";
        document.getElementById('right-prob').textContent = "50%";
        document.getElementById('d2-value').textContent = "0.50";
      }
      
      // Ajouter un √©v√©nement dans le journal
      const cogLog = document.getElementById('cognitive-log');
      const now = new Date();
      const timeStr = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
      
      const eventNode = document.createElement('div');
      eventNode.className = 'event-entry';
      
      let eventText = "";
      if (mode === 'pin') {
        eventText = "Activation D2Pin - Mode Analytique";
      } else if (mode === 'stim') {
        eventText = "Activation D2Stim - Mode Cr√©atif";
      } else {
        eventText = "Mode √âquilibr√© activ√©";
      }
      
      eventNode.innerHTML = `<span class="event-time">${timeStr}</span> ${eventText}`;
      cogLog.insertBefore(eventNode, cogLog.firstChild);
      
      // Limiter √† 5 √©v√©nements
      if (cogLog.children.length > 5) {
        cogLog.removeChild(cogLog.lastChild);
      }
    }
    
    // Fonction pour traiter une requ√™te
    function processQuery(query) {
      if (!query.trim()) return;
      
      // Montrer l'√©tat "en traitement"
      document.getElementById('focus-ind').textContent = "...";
      document.getElementById('time-ind').textContent = "...";
      document.getElementById('type-ind').textContent = "...";
      
      // Ajouter un √©v√©nement dans le journal
      const cogLog = document.getElementById('cognitive-log');
      const now = new Date();
      const timeStr = `${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
      
      const eventNode = document.createElement('div');
      eventNode.className = 'event-entry';
      eventNode.innerHTML = `<span class="event-time">${timeStr}</span> Requ√™te: "${query.substring(0, 20)}${query.length > 20 ? '...' : ''}"`;
      cogLog.insertBefore(eventNode, cogLog.firstChild);
      
      // Simuler le traitement
      setTimeout(() => {
        // G√©n√©rer des r√©sultats al√©atoires
        const focus = (Math.random() * 0.5 + 0.3).toFixed(2);
        const time = (Math.random() * 1.5 + 0.2).toFixed(1);
        const types = ["Analytique", "Cr√©atif", "√âquilibr√©"];
        const type = types[Math.floor(Math.random() * types.length)];
        
        // Mettre √† jour les indicateurs
        document.getElementById('focus-ind').textContent = focus;
        document.getElementById('time-ind').textContent = time + "s";
        document.getElementById('type-ind').textContent = type;
        
        // Ajouter √©v√©nement de compl√©tion
        const completionEvent = document.createElement('div');
        completionEvent.className = 'event-entry';
        completionEvent.innerHTML = `<span class="event-time">${timeStr}</span> Traitement termin√© (${time}s - ${type})`;
        cogLog.insertBefore(completionEvent, cogLog.firstChild);
        
        // Limiter √† 5 √©v√©nements
        if (cogLog.children.length > 5) {
          cogLog.removeChild(cogLog.lastChild);
        }
        
        // Simuler l'activation des h√©misph√®res en fonction du type
        const hemisphereL = document.querySelector('.hemisphere-left');
        const hemisphereR = document.querySelector('.hemisphere-right');
        
        if (type === "Analytique") {
          hemisphereL.style.opacity = "1";
          hemisphereR.style.opacity = "0.6";
          document.getElementById('left-prob').textContent = "70%";
          document.getElementById('right-prob').textContent = "30%";
        } else if (type === "Cr√©atif") {
          hemisphereL.style.opacity = "0.6";
          hemisphereR.style.opacity = "1";
          document.getElementById('left-prob').textContent = "30%";
          document.getElementById('right-prob').textContent = "70%";
        } else {
          hemisphereL.style.opacity = "0.8";
          hemisphereR.style.opacity = "0.8";
          document.getElementById('left-prob').textContent = "50%";
          document.getElementById('right-prob').textContent = "50%";
        }
        
        // Mettre √† jour les compteurs
        updateCounters();
      }, 1000);
    }
  });
</script>
{% endblock %}